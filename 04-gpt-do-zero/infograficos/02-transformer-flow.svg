<svg width="800" height="950" viewBox="0 0 800 950" xmlns="http://www.w3.org/2000/svg">
  <!-- Fundo Material Design -->
  <rect width="800" height="950" fill="#F8F9FA" rx="16"/>
  <defs>
    <pattern id="dotGrid" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
      <circle cx="2" cy="2" r="1" fill="#DADCE0"/>
    </pattern>
    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="10" flood-opacity="0.1"/>
    </filter>
  </defs>
  <rect width="800" height="950" fill="url(#dotGrid)" rx="16"/>

  <!-- TÍTULO -->
  <text x="400" y="45" font-family="Google Sans, Roboto, Arial" font-size="22" fill="#202124" text-anchor="middle" font-weight="bold">Fluxo de Dados: Anatomia do Bloco Transformer</text>
  <text x="400" y="70" font-family="Roboto, Arial" font-size="14" fill="#5F6368" text-anchor="middle">Sequência exata de operações e preservação de informação (Residuals)</text>

  <!-- 4. SAÍDA FINAL (TOPO) -->
  <g transform="translate(300, 100)">
    <rect width="200" height="50" rx="25" fill="#E6F4EA" stroke="#34A853" stroke-width="2" filter="url(#softShadow)"/>
    <text x="100" y="32" font-family="Google Sans, Roboto, Arial" font-size="14" fill="#137333" text-anchor="middle" font-weight="bold">SAÍDA DO BLOCO</text>
  </g>

  <!-- BLOCO 2: REFINAMENTO (FFN) -->
  <g transform="translate(150, 180)">
    <rect width="500" height="320" rx="24" fill="#FFFFFF" stroke="#DADCE0" stroke-width="1" filter="url(#softShadow)"/>
    <text x="250" y="35" font-family="Google Sans, Roboto, Arial" font-size="14" fill="#5F6368" text-anchor="middle" font-weight="bold">MÓDULO DE REFINAMENTO (FEED-FORWARD)</text>

    <!-- Adição Residual 2 -->
    <circle cx="250" cy="80" r="25" fill="#F1F3F4" stroke="#BDC1C6"/>
    <text x="250" y="88" font-family="Roboto, Arial" font-size="24" fill="#202124" text-anchor="middle">+</text>
    <text x="285" y="85" font-family="Roboto, Arial" font-size="11" fill="#5F6368">Soma Residual</text>

    <!-- Feed Forward Layer -->
    <rect x="100" y="130" width="300" height="80" rx="12" fill="#FEF7E0" stroke="#FBBC04" stroke-width="1.5"/>
    <text x="250" y="165" font-family="Google Sans, Roboto, Arial" font-size="16" fill="#E37400" text-anchor="middle" font-weight="bold">Feed-Forward Network (MLP)</text>
    <text x="250" y="185" font-family="Roboto, Arial" font-size="11" fill="#B06000" text-anchor="middle">Camadas lineares + Ativação GELU</text>

    <!-- Layer Norm 2 -->
    <rect x="150" y="240" width="200" height="40" rx="8" fill="#F8F9FA" stroke="#DADCE0"/>
    <text x="250" y="265" font-family="Roboto, Arial" font-size="12" fill="#5F6368" text-anchor="middle" font-weight="bold">Layer Normalization</text>

    <!-- Linha Residual 2 (Atalho) -->
    <path d="M 250 320 L 50 320 L 50 80 L 225 80" stroke="#FBBC04" stroke-width="2" stroke-dasharray="6 3" fill="none" opacity="0.4"/>
  </g>

  <!-- SETA INTERMEDIÁRIA -->
  <path d="M 400 540 L 400 500" stroke="#DADCE0" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- BLOCO 1: CONTEXTO (MHA) -->
  <g transform="translate(150, 540)">
    <rect width="500" height="320" rx="24" fill="#FFFFFF" stroke="#DADCE0" stroke-width="1" filter="url(#softShadow)"/>
    <text x="250" y="35" font-family="Google Sans, Roboto, Arial" font-size="14" fill="#5F6368" text-anchor="middle" font-weight="bold">MÓDULO DE CONTEXTO (ATENÇÃO)</text>

    <!-- Adição Residual 1 -->
    <circle cx="250" cy="80" r="25" fill="#F1F3F4" stroke="#BDC1C6"/>
    <text x="250" y="88" font-family="Roboto, Arial" font-size="24" fill="#202124" text-anchor="middle">+</text>
    <text x="285" y="85" font-family="Roboto, Arial" font-size="11" fill="#5F6368">Soma Residual</text>

    <!-- Self-Attention Layer -->
    <rect x="100" y="130" width="300" height="80" rx="12" fill="#E8F0FE" stroke="#1A73E8" stroke-width="1.5"/>
    <text x="250" y="165" font-family="Google Sans, Roboto, Arial" font-size="16" fill="#1967D2" text-anchor="middle" font-weight="bold">Multi-Head Attention</text>
    <text x="250" y="185" font-family="Roboto, Arial" font-size="11" fill="#1A73E8" text-anchor="middle">Cálculos Q, K, V e contexto global</text>

    <!-- Layer Norm 1 -->
    <rect x="150" y="240" width="200" height="40" rx="8" fill="#F8F9FA" stroke="#DADCE0"/>
    <text x="250" y="265" font-family="Roboto, Arial" font-size="12" fill="#5F6368" text-anchor="middle" font-weight="bold">Layer Normalization</text>

    <!-- Linha Residual 1 (Atalho) -->
    <path d="M 250 320 L 50 320 L 50 80 L 225 80" stroke="#1A73E8" stroke-width="2" stroke-dasharray="6 3" fill="none" opacity="0.4"/>
  </g>

  <!-- 1. ENTRADA (BASE) -->
  <g transform="translate(250, 880)">
    <rect width="300" height="50" rx="12" fill="#FFFFFF" stroke="#DADCE0" stroke-width="2"/>
    <text x="150" y="32" font-family="Roboto, Arial" font-size="14" fill="#202124" text-anchor="middle">Entrada do Bloco (Vetor X)</text>
  </g>

  <!-- SETAS DE FLUXO EXTERNAS -->
  <path d="M 400 880 L 400 860" stroke="#DADCE0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 400 180 L 400 155" stroke="#34A853" stroke-width="2" marker-end="url(#arrowheadGreen)"/>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#DADCE0" />
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34A853" />
    </marker>
  </defs>
</svg>
